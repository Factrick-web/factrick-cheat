<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Factrick - Admin</title>
<style>
body { 
  margin:0; 
  font-family:Arial; 
  background:linear-gradient(135deg,#1c1c1c,#3d0066); 
  color:white; 
  display:flex; 
  justify-content:center; 
  align-items:flex-start; 
  padding-top:30px;
  min-height:100vh;
}
.box { 
  background: rgba(0,0,0,0.85); 
  padding:30px; 
  border-radius:15px; 
  box-shadow:0 0 20px rgba(255,0,255,0.4); 
  text-align:center; 
  width:450px; 
  margin-bottom:20px;
}
input, button, select { 
  margin:10px 0; 
  padding:10px; 
  border-radius:8px; 
  border:none; 
  width:90%; 
}
button { 
  background:#a200ff; 
  color:white; 
  cursor:pointer; 
  font-weight:bold; 
}
button:hover { background:#6d00aa; }
h2,h3 { margin-bottom:10px; }
.user-list { 
  text-align:left; 
  max-height:150px; 
  overflow-y:auto; 
  background:rgba(255,255,255,0.05); 
  padding:10px; 
  border-radius:10px; 
}
.user-list div { margin-bottom:5px; }
.result { margin-top:5px; color:#0f0; font-weight:bold;}
</style>
</head>
<body>

<div class="box">
  <h2>Admin Panel - Factrick</h2>

  <!-- USUARIOS -->
  <div class="section">
    <h3>Usuarios registrados</h3>
    <div id="userList" class="user-list"></div>
  </div>

  <!-- GENERAR KEY -->
  <div class="section">
    <h3>Generar Key</h3>
    <select id="genUser"></select>
    <select id="producto">
      <option value="drip">Drip Client</option>
      <option value="hg">HG CHEAT</option>
    </select>
    <select id="tiempo">
      <option value="1">1 Día - $1</option>
      <option value="7">7 Días - $5</option>
      <option value="15">15 Días - $12</option>
      <option value="30">1 Mes - $25</option>
      <option value="365">1 Año - $50</option>
    </select>
    <button onclick="adminGenerarKey()">Generar</button>
    <div class="result" id="keyResult"></div>
  </div>

  <!-- RESET KEY -->
  <div class="section">
    <h3>Reset Key</h3>
    <select id="resetUser"></select>
    <input type="text" id="resetInput" placeholder="Introduce la key">
    <button onclick="adminResetKey()">Resetear</button>
    <div class="result" id="resetResult"></div>
  </div>

  <!-- NOTIFICACIONES -->
  <div class="section">
    <h3>Enviar Notificación</h3>
    <select id="notiUser"></select>
    <input type="text" id="notiText" placeholder="Mensaje de notificación">
    <button onclick="sendNoti()">Enviar</button>
    <div class="result" id="notiResult"></div>
  </div>

  <button onclick="logoutAdmin()">Cerrar sesión</button>
</div>

<script>
// --- VARIABLES ---
const userListDiv = document.getElementById("userList");
const genUser = document.getElementById("genUser");
const resetUser = document.getElementById("resetUser");
const notiUser = document.getElementById("notiUser");
const productoSelect = document.getElementById("producto");
const tiempoSelect = document.getElementById("tiempo");
const keyResult = document.getElementById("keyResult");
const resetInput = document.getElementById("resetInput");
const resetResult = document.getElementById("resetResult");
const notiText = document.getElementById("notiText");
const notiResult = document.getElementById("notiResult");

// Precios
const precios = { "1":1, "7":5, "15":12, "30":25, "365":50 };

// --- CARGAR USUARIOS ---
function loadUsers(){
  let users = JSON.parse(localStorage.getItem("users")||"{}");
  userListDiv.innerHTML="";
  [genUser, resetUser, notiUser].forEach(s=>s.innerHTML="");
  for(let u in users){
    userListDiv.innerHTML += `<div>${u} | Saldo: $${users[u].saldo}</div>`;
    genUser.innerHTML += `<option value="${u}">${u}</option>`;
    resetUser.innerHTML += `<option value="${u}">${u}</option>`;
    notiUser.innerHTML += `<option value="${u}">${u}</option>`;
  }
}

// --- ADMIN GENERAR KEY ---
function adminGenerarKey(){
  let user = genUser.value;
  let users = JSON.parse(localStorage.getItem("users")||"{}");
  let producto = productoSelect.value;
  let tiempoVal = tiempoSelect.value;
  let precio = precios[tiempoVal];

  if(users[user].saldo < precio){
    keyResult.innerText = "Saldo insuficiente";
    return;
  }

  users[user].saldo -= precio;
  let key = producto==="drip" ? "KEY-"+Math.floor(1000000000+Math.random()*9000000000)
                               : "HG-FACTRICK-"+Math.floor(10000+Math.random()*90000);
  if(!users[user].keys) users[user].keys=[];
  users[user].keys.push(key);

  localStorage.setItem("users", JSON.stringify(users));
  loadUsers();
  keyResult.innerText = `✅ Key generada para ${user}: ${key}`;
}

// --- ADMIN RESET KEY ---
function adminResetKey(){
  let user = resetUser.value;
  let keyVal = resetInput.value.trim();
  if(!keyVal) { resetResult.innerText = "⚠️ Ingresa una key válida"; return; }
  let users = JSON.parse(localStorage.getItem("users")||"{}");
  if(users[user].keys){
    users[user].keys = users[user].keys.filter(k=>k!==keyVal);
  }
  localStorage.setItem("users", JSON.stringify(users));
  resetInput.value="";
  resetResult.innerText = `🔄 Key reseteada para ${user}`;
}

// --- ENVIAR NOTIFICACIÓN ---
function sendNoti(){
  const user = notiUser.value;
  const msg = notiText.value.trim();
  if(!msg) return alert("Escribe un mensaje");
  let users = JSON.parse(localStorage.getItem("users")||"{}");
  if(!users[user].notificaciones) users[user].notificaciones=[];
  users[user].notificaciones.push(msg);
  localStorage.setItem("users", JSON.stringify(users));
  notiResult.innerText = `Notificación enviada a ${user}`;
  notiText.value="";
}

// --- LOGOUT ---
function logoutAdmin(){ window.location.href="index.html"; }

// --- INICIALIZACIÓN ---
window.onload = function(){ loadUsers(); };
</script>

</body>
</html>
