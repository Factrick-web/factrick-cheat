<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Factrick - Usuarios</title>
<style>
body { 
  margin:0; 
  font-family:Arial; 
  background:linear-gradient(135deg,#1c1c1c,#3d0066); 
  color:white; 
  display:flex; 
  justify-content:center; 
  align-items:center; 
  height:100vh; 
}
.box { 
  background: rgba(0,0,0,0.8); 
  padding:30px; 
  border-radius:15px; 
  box-shadow:0 0 20px rgba(255,0,255,0.4); 
  text-align:center; 
  width:350px; 
  display:none; 
}
.box.active { display:block; }
input, select, button { 
  margin:10px 0; 
  padding:10px; 
  border-radius:8px; 
  border:none; 
  width:90%; 
}
button { 
  background:#a200ff; 
  color:white; 
  cursor:pointer; 
  font-weight:bold; 
}
button:hover { background:#6d00aa; }
.topbar { 
  position:absolute; 
  top:10px; 
  right:10px; 
  background:#111; 
  padding:10px 20px; 
  border-radius:10px; 
  font-size:14px; 
  box-shadow:0 0 10px rgba(255,255,255,0.3); 
}
.result { margin-top:15px; font-weight:bold; color:#0f0; }
.section { margin-top:20px; background:rgba(255,255,255,0.05); padding:15px; border-radius:10px; }
a { color:#aaa; text-decoration:none; cursor:pointer; }
</style>
</head>
<body>

<!-- LOGIN -->
<div class="box active" id="loginBox">
  <h2>Acceso</h2>
  <input type="text" id="userLogin" placeholder="Usuario">
  <input type="password" id="passLogin" placeholder="Contrase√±a">
  <button onclick="loginUser()">Entrar</button>
  <p id="loginError" style="color:red;display:none;">Credenciales incorrectas</p>
  <p><a onclick="showRegister()">Registrarse</a></p>

  <!-- Bot√≥n Admin integrado -->
  <button onclick="window.location.href='admin.html'" 
          style="background:#f500ff; margin-top:10px; font-weight:bold;">
    üîë Acceso Admin
  </button>
</div>

<!-- REGISTER -->
<div class="box" id="registerBox">
  <h2>Registro</h2>
  <input type="text" id="userReg" placeholder="Usuario">
  <input type="password" id="passReg" placeholder="Contrase√±a">
  <button onclick="registerUser()">Registrar</button>
  <p><a onclick="showLogin()">Volver a Login</a></p>
</div>

<!-- PANEL USUARIO -->
<div class="box" id="panelBox">
  <div class="topbar" id="topbar"></div>
  <h2>Factrick Revendedor</h2>

  <div class="section">
    <h3>Generar Key</h3>
    <select id="producto">
      <option value="drip">Drip Client</option>
      <option value="hg">HG CHEAT</option>
    </select>
    <select id="tiempo">
      <option value="1">1 D√≠a - $1</option>
      <option value="7">7 D√≠as - $5</option>
      <option value="15">15 D√≠as - $12</option>
      <option value="30">1 Mes - $25</option>
      <option value="365">1 A√±o - $50</option>
    </select>
    <button onclick="generarKey()">Generar</button>
    <div class="result" id="resultado"></div>
  </div>

  <div class="section">
    <h3>Reset Key</h3>
    <input type="text" id="resetInput" placeholder="Introduce la key">
    <button onclick="resetKey()">Resetear</button>
    <div class="result" id="resetMsg"></div>
  </div>

  <button onclick="logout()">Cerrar Sesi√≥n</button>
</div>

<script>
// --- VARIABLES ---
const precios = { "1":1, "7":5, "15":12, "30":25, "365":50 };
let currentUser = null;

// ELEMENTOS
const loginBox = document.getElementById("loginBox");
const registerBox = document.getElementById("registerBox");
const panelBox = document.getElementById("panelBox");
const userLogin = document.getElementById("userLogin");
const passLogin = document.getElementById("passLogin");
const userReg = document.getElementById("userReg");
const passReg = document.getElementById("passReg");
const topbar = document.getElementById("topbar");
const resultado = document.getElementById("resultado");
const resetInput = document.getElementById("resetInput");
const resetMsg = document.getElementById("resetMsg");
const loginError = document.getElementById("loginError");
const productoSelect = document.getElementById("producto");
const tiempoSelect = document.getElementById("tiempo");

// --- VISTAS ---
function showRegister(){ loginBox.classList.remove("active"); registerBox.classList.add("active"); }
function showLogin(){ registerBox.classList.remove("active"); loginBox.classList.add("active"); }

// --- REGISTRO ---
function registerUser(){
  const u = userReg.value.trim();
  const p = passReg.value.trim();
  if(!u||!p) return alert("Completa usuario y contrase√±a");
  let users = JSON.parse(localStorage.getItem("users")||"{}");
  if(users[u]) return alert("Usuario ya existe");
  users[u] = {pass:p, saldo:0};
  localStorage.setItem("users", JSON.stringify(users));
  alert("Usuario registrado");
  showLogin();
}

// --- LOGIN ---
function loginUser(){
  const u = userLogin.value.trim();
  const p = passLogin.value.trim();
  let users = JSON.parse(localStorage.getItem("users")||"{}");
  if(users[u] && users[u].pass===p){
    currentUser = u;
    localStorage.setItem("currentUser",currentUser);
    updatePanel();
    loginBox.classList.remove("active");
    panelBox.classList.add("active");
    loginError.style.display="none";
  } else { loginError.style.display="block"; }
}

// --- PANEL ---
function updatePanel(){
  let users = JSON.parse(localStorage.getItem("users")||"{}");
  if(!currentUser || !users[currentUser]) return;
  topbar.innerText = `User: ${currentUser} | Saldo: $${users[currentUser].saldo}`;
}

// --- GENERAR KEY ---
function generarKey(){
  let users = JSON.parse(localStorage.getItem("users")||"{}");
  if(!currentUser || !users[currentUser]) return;

  let producto = productoSelect.value;
  let tiempoVal = tiempoSelect.value;
  let precio = precios[tiempoVal];

  if(users[currentUser].saldo < precio){
    resultado.innerText = "Saldo insuficiente";
    return;
  }

  users[currentUser].saldo -= precio;
  localStorage.setItem("users", JSON.stringify(users));
  updatePanel();

  let key = producto==="drip" ? "KEY-"+Math.floor(1000000000+Math.random()*9000000000)
                               : "HG-FACTRICK-"+Math.floor(10000+Math.random()*90000);
  resultado.innerText = "‚úÖ Key generada: "+key;
}

// --- RESET KEY ---
function resetKey(){
  let keyVal = resetInput.value.trim();
  resetMsg.innerText = keyVal.length>0 ? "üîÑ Key correctamente reseteada" : "‚ö†Ô∏è Ingresa una key v√°lida";
}

// --- LOGOUT ---
function logout(){
  currentUser=null;
  localStorage.removeItem("currentUser");
  panelBox.classList.remove("active");
  loginBox.classList.add("active");
}

// --- MANTENER SESI√ìN ---
window.onload = function(){
  let savedUser = localStorage.getItem("currentUser");
  if(savedUser){
    currentUser = savedUser;
    updatePanel();
    loginBox.classList.remove("active");
    panelBox.classList.add("active");
  }
};
</script>

</body>
</html>
